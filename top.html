<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bouncing Popups</title>
</head>
<body>
  <h1>Bouncing Popups</h1>
  <p>Click the button to start bouncing popups. Press the letter <strong>I</strong> to close all popups.</p>
  <button id="start-bouncing">Start Bouncing Popups</button>
  <button id="stop-bouncing">Stop Bouncing Popups</button>

  <script>
    const popups = []; // Array to store popup references
    const speeds = []; // Array to store speed and direction for each popup
    const intervalHandles = []; // Array to store intervals for each popup
    const popupSize = { width: 300, height: 200 }; // Popup dimensions

    // Function to create a new popup
    function createBouncingPopup() {
      const screenWidth = window.screen.availWidth;
      const screenHeight = window.screen.availHeight;

      // Initial random position
      let posX = Math.random() * (screenWidth - popupSize.width);
      let posY = Math.random() * (screenHeight - popupSize.height);

      // Random speeds (both x and y direction)
      const speedX = Math.random() * 5 + 2; // Random speed between 2 and 7
      const speedY = Math.random() * 5 + 2;

      const newPopup = window.open(
        "",
        `_blank`,
        `width=${popupSize.width},height=${popupSize.height},top=${posY},left=${posX}`
      );

      if (newPopup) {
        newPopup.document.write(`
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Popup</title>
            <style>
              body {
                margin: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                font-family: Arial, sans-serif;
                background-color: #ffcccb;
              }
              h1 {
                color: #007BFF;
                text-align: center;
              }
            </style>
          </head>
          <body>
            <h1>Bouncing Popup!</h1>
          </body>
          </html>
        `);

        popups.push(newPopup); // Store the popup reference
        speeds.push({ x: speedX, y: speedY }); // Store its speed

        // Start moving the popup
        const interval = setInterval(() => {
          if (newPopup.closed) {
            clearInterval(interval);
            return;
          }

          // Update position
          posX += speeds[speeds.length - 1].x;
          posY += speeds[speeds.length - 1].y;

          // Bounce off the edges
          if (posX <= 0 || posX + popupSize.width >= screenWidth) {
            speeds[speeds.length - 1].x *= -1; // Reverse X direction
          }
          if (posY <= 0 || posY + popupSize.height >= screenHeight) {
            speeds[speeds.length - 1].y *= -1; // Reverse Y direction
          }

          // Move the popup
          newPopup.moveTo(posX, posY);
        }, 20); // Update position every 20ms

        intervalHandles.push(interval); // Store the interval handle
      } else {
        alert("Popup blocked! Please allow popups for this site.");
      }
    }

    // Function to close all popups
    function closeAllPopups() {
      popups.forEach((popup, index) => {
        if (popup && !popup.closed) {
          popup.close();
        }
        clearInterval(intervalHandles[index]); // Stop the movement
      });
      popups.length = 0;
      speeds.length = 0;
      intervalHandles.length = 0;
    }

    // Event listeners for buttons
    document.getElementById("start-bouncing").addEventListener("click", () => {
      // Create a new bouncing popup every second
      const bouncingInterval = setInterval(createBouncingPopup, 1000);

      // Store this interval so you can stop it later
      intervalHandles.push(bouncingInterval);
    });

    document.getElementById("stop-bouncing").addEventListener("click", closeAllPopups);

    // Close all popups when the "I" key is pressed
    document.addEventListener("keydown", (event) => {
      if (event.key.toLowerCase() === "i") {
        closeAllPopups();
      }
    });
  </script>
</body>
</html>
